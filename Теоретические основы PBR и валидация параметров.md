# **Теоретические основы PBR-рендеринга и допустимые диапазоны значений (анализ теоретических основ PBR-рендеринга и определение допустимых диапазонов)**

## **1\. Эволюция Physically Based Rendering (PBR)**

Physically Based Rendering — это математическая модель, целью которой является воспроизведение поведения света в соответствии с законами термодинамики и оптики. В индустрии стандартом де\-факто считается «Модель Disney», представленная Брентом Берли на SIGGRAPH 2012, которая объединила сложную физику с интуитивно понятными параметрами для художников.

## **2\. Физические принципы и математическая модель**

### **Модель микрограней и функция BRDF**

В основе PBR лежит теория микрограней (**Microfacet Theory**). С точки зрения физики, ни одна поверхность (кроме зеркала) не является идеально гладкой. Она состоит из мириад крошечных микроскопических граней.

Для описания этого процесса используется функция **BRDF** (Bidirectional Reflective Distribution Function). Современный стандарт в Unreal Engine — это модель **Cook-Torrance**, которая состоит из трех компонентов:

1. **D (Distribution function):** Распределение микрограней (насколько они параллельны друг другу). Используется алгоритм **Trowbridge-Reitz GGX**.  
2. **G (Geometric shadowing/masking):** Учитывает, как микрограни заслоняют друг друга.  
3. **F (Fresnel):** Уравнение Френеля, определяющее процент отраженного света в зависимости от угла обзора.

## **Осноные карты PBR, которые шороко используются в видеогровых движках:**
### **Карта Albedo**

**Для анализа использовались эталонные значения из документации Epic Games и докладов Sebastien Lagarde. Все значения яркости для материалов основаны на фотометрических измерениях реальных поверхностей.**
Карту albedo (т лат. albus - белый) - это термин, обозначающий отражательную способность поверхности.
Так же карту albedo называют base color или diffuse.

По факту, эта карта несёт в себе информацию только о цвете объекта в условиях рассеянного освещения.

* **Минимальный порог (30-50 sRGB):** Соответствует свежему асфальту или древесному углю. Отражательная способность (Albedo) ниже 0.02 (2%) физически невозможна для твердых тел. Если художник использует 0 sRGB, поверхность поглощает 100% фотонов, что нарушает закон сохранения энергии и делает невозможным расчет вторичных отражений (GI).  
* **Максимальный порог (240-243 sRGB):** Соответствует чистому снегу или оксиду магния. Альбедо выше 0.9 (90%) приводит к тому, что свет бесконечно отражается между поверхностями.

### **Карта Normal Map**

### **Карта Roughness/Glossiness**

### **Карта Metalic**

### **Карта Specular**

### **Карта Ambient Oclussion**

### **Остальные карты:**
Так же существует множетсво других карт, таких как: Curvature, Thickness..., но они используются в основном при создании основных карт и не использутся в самом движке (либо в ситуативных случаях).

## **3\. Сравнение систем: Standard Shading vs Substrate**

### **Рабочий процесс (Metallic/Roughness)**

В стандартном материале Unreal Engine мы разделяем материал на электрики и диэлектрики.

* По правилам, карта Metallic должна быть бинарной, то есть какждый пиксель должен быть равен либо 0 (чёрный), либо 1 (белый). Но для художественности делают карты и с промежуточными значения (к примеру, для иммитации пыли или грящи на металле).
* Поскольку Metallic является чёрно-белой картой, то цвет зеркальных отражений (цвет металла) берётся из карты albedo (или же base color).
* Карта Roughness обозначает шершавость поверхности, где 0 - это идеально гладкая (зеркальная) поверхность, а 1 - максимально матовая.

### **Рабочий процесс (Specular/Glossiness)**

Данный рабочй процесс не используется в Unreal Engine.

* Карта Specular здесь цветная, а значит, что цвет зеркальных отражений теперь берётся не из albedo (base color), а из specular.
* Карта Glossiness - это инвертированная карта Roughness. То есть тут наоборот 0 - матовая, а 1 - глянцевая поверхность.

### **Unreal Engine Substrate (Framework нового поколения)**

**Substrate** - это замена классической модели "одного слоя". В реальности материалы часто многослойны (например, краска на металле под слоем лака).

В Substrate вместо Metallic используется более точное описание через Specular F0 и F90.



